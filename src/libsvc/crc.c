/**
 * @file crc.c
 * @author Alexey Hohlov <root@amper.me>
 * @copyright WTFPL License
 * @date 2021
 * @brief Функции подсчета CRC
 */

#include <svc/crc.h>

static const uint16_t crc_table[256] = {
    0x0U,    0x1EA1U, 0x3D42U, 0x23E3U, 0x7A84U, 0x6425U, 0x47C6U, 0x5967U, 0xF508U, 0xEBA9U,
    0xC84AU, 0xD6EBU, 0x8F8CU, 0x912DU, 0xB2CEU, 0xAC6FU, 0x449BU, 0x5A3AU, 0x79D9U, 0x6778U,
    0x3E1FU, 0x20BEU, 0x35DU,  0x1DFCU, 0xB193U, 0xAF32U, 0x8CD1U, 0x9270U, 0xCB17U, 0xD5B6U,
    0xF655U, 0xE8F4U, 0x8936U, 0x9797U, 0xB474U, 0xAAD5U, 0xF3B2U, 0xED13U, 0xCEF0U, 0xD051U,
    0x7C3EU, 0x629FU, 0x417CU, 0x5FDDU, 0x6BAU,	 0x181BU, 0x3BF8U, 0x2559U, 0xCDADU, 0xD30CU,
    0xF0EFU, 0xEE4EU, 0xB729U, 0xA988U, 0x8A6BU, 0x94CAU, 0x38A5U, 0x2604U, 0x5E7U,  0x1B46U,
    0x4221U, 0x5C80U, 0x7F63U, 0x61C2U, 0xBCE7U, 0xA246U, 0x81A5U, 0x9F04U, 0xC663U, 0xD8C2U,
    0xFB21U, 0xE580U, 0x49EFU, 0x574EU, 0x74ADU, 0x6A0CU, 0x336BU, 0x2DCAU, 0xE29U,  0x1088U,
    0xF87CU, 0xE6DDU, 0xC53EU, 0xDB9FU, 0x82F8U, 0x9C59U, 0xBFBAU, 0xA11BU, 0xD74U,  0x13D5U,
    0x3036U, 0x2E97U, 0x77F0U, 0x6951U, 0x4AB2U, 0x5413U, 0x35D1U, 0x2B70U, 0x893U,  0x1632U,
    0x4F55U, 0x51F4U, 0x7217U, 0x6CB6U, 0xC0D9U, 0xDE78U, 0xFD9BU, 0xE33AU, 0xBA5DU, 0xA4FCU,
    0x871FU, 0x99BEU, 0x714AU, 0x6FEBU, 0x4C08U, 0x52A9U, 0xBCEU,  0x156FU, 0x368CU, 0x282DU,
    0x8442U, 0x9AE3U, 0xB900U, 0xA7A1U, 0xFEC6U, 0xE067U, 0xC384U, 0xDD25U, 0xD745U, 0xC9E4U,
    0xEA07U, 0xF4A6U, 0xADC1U, 0xB360U, 0x9083U, 0x8E22U, 0x224DU, 0x3CECU, 0x1F0FU, 0x1AEU,
    0x58C9U, 0x4668U, 0x658BU, 0x7B2AU, 0x93DEU, 0x8D7FU, 0xAE9CU, 0xB03DU, 0xE95AU, 0xF7FBU,
    0xD418U, 0xCAB9U, 0x66D6U, 0x7877U, 0x5B94U, 0x4535U, 0x1C52U, 0x2F3U,  0x2110U, 0x3FB1U,
    0x5E73U, 0x40D2U, 0x6331U, 0x7D90U, 0x24F7U, 0x3A56U, 0x19B5U, 0x714U,  0xAB7BU, 0xB5DAU,
    0x9639U, 0x8898U, 0xD1FFU, 0xCF5EU, 0xECBDU, 0xF21CU, 0x1AE8U, 0x449U,  0x27AAU, 0x390BU,
    0x606CU, 0x7ECDU, 0x5D2EU, 0x438FU, 0xEFE0U, 0xF141U, 0xD2A2U, 0xCC03U, 0x9564U, 0x8BC5U,
    0xA826U, 0xB687U, 0x6BA2U, 0x7503U, 0x56E0U, 0x4841U, 0x1126U, 0xF87U,  0x2C64U, 0x32C5U,
    0x9EAAU, 0x800BU, 0xA3E8U, 0xBD49U, 0xE42EU, 0xFA8FU, 0xD96CU, 0xC7CDU, 0x2F39U, 0x3198U,
    0x127BU, 0xCDAU,  0x55BDU, 0x4B1CU, 0x68FFU, 0x765EU, 0xDA31U, 0xC490U, 0xE773U, 0xF9D2U,
    0xA0B5U, 0xBE14U, 0x9DF7U, 0x8356U, 0xE294U, 0xFC35U, 0xDFD6U, 0xC177U, 0x9810U, 0x86B1U,
    0xA552U, 0xBBF3U, 0x179CU, 0x93DU,	0x2ADEU, 0x347FU, 0x6D18U, 0x73B9U, 0x505AU, 0x4EFBU,
    0xA60FU, 0xB8AEU, 0x9B4DU, 0x85ECU, 0xDC8BU, 0xC22AU, 0xE1C9U, 0xFF68U, 0x5307U, 0x4DA6U,
    0x6E45U, 0x70E4U, 0x2983U, 0x3722U, 0x14C1U, 0xA60U};

uint16_t
crc16(const uint8_t src[], size_t size, uint16_t seed)
{
	uint16_t crc16 = ~seed;

	for (size_t i = 0; i < size; i++) {
		uint8_t b = src[i];
		crc16 = (crc16 >> 8U) ^ crc_table[(crc16 & 0xFFU) ^ b];
	}
	return ~crc16;
}
